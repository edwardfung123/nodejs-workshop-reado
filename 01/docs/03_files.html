<!DOCTYPE html>

<html>
<head>
  <title>03_files.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="01_hello_world.html">
                  01_hello_world.js
                </a>
              
                
                <a class="source" href="02_file.html">
                  02_file.js
                </a>
              
                
                <a class="source" href="03_files.html">
                  03_files.js
                </a>
              
                
                <a class="source" href="04_files2.html">
                  04_files2.js
                </a>
              
                
                <a class="source" href="05_redso_module.html">
                  05_redso_module.js
                </a>
              
                
                <a class="source" href="05_using_modules.html">
                  05_using_modules.js
                </a>
              
                
                <a class="source" href="06_http_server_1.html">
                  06_http_server_1.js
                </a>
              
                
                <a class="source" href="06_http_server_2.html">
                  06_http_server_2.js
                </a>
              
                
                <a class="source" href="06_http_server_3.html">
                  06_http_server_3.js
                </a>
              
                
                <a class="source" href="06_http_server_4.html">
                  06_http_server_4.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>03_files.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>load the fs module
The full doc (<a href="https://nodejs.org/docs/v0.10.35/api/fs.html">https://nodejs.org/docs/v0.10.35/api/fs.html</a>)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Let’s read a file using the asyn way.
Asyn operations is the CORE of node.
See: <a href="https://nodejs.org/docs/v0.10.35/api/fs.html#fs_fs_readfile_filename_options_callback">https://nodejs.org/docs/v0.10.35/api/fs.html#fs_fs_readfile_filename_options_callback</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>fs.readFile(<span class="hljs-string">'/etc/passwd'</span>, {encoding: <span class="hljs-string">'utf-8'</span>}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>)</span>{
  <span class="hljs-keyword">if</span> (err){
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'We got en error'</span>, err);
    <span class="hljs-keyword">throw</span> err;
  }

  <span class="hljs-built_in">console</span>.log(data);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Let’s try read another file here.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>fs.readFile(<span class="hljs-string">'./package.json'</span>, {encoding: <span class="hljs-string">'utf-8'</span>}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>)</span>{
  <span class="hljs-keyword">if</span> (err){
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'We got en error'</span>, err);
    <span class="hljs-keyword">throw</span> err;
  }

  <span class="hljs-built_in">console</span>.log(data);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Since the code is running in asyn mode, the two readFile() call are actually
run in “parallel”. Which callback will be triggered first is “unpredictable”.
It really depends on the filesize, OS, CPU usage and etc.</p>
<p>In this case, the /etc/shadow is a larger file. It takes more time for the OS
to load the whole file and call the callback. So the /etc/password is printed
after the content of ./package.json</p>
<p>The moral of the story: Coding in async style is really hard. </p>

            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
